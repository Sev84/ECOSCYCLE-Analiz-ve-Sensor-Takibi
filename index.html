<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECOSCYCLE - Akıllı Kontrol Paneli</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        :root {
            --primary-color: #2ecc71;
            --secondary-color: #3498db;
            --dark-bg: #073B4C; /* Koyu Mavi */
            --card-bg: rgba(17, 47, 65, 0.7);
            --text-color: #f1f1f1;
            --nav-text-color: #f1f1f1;
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.2);
            --warning-color: #f39c12;
            --critical-color: #e74c3c;
            --info-color-blue: #3498db;
        }
        *, *::before, *::after { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body, html {
            margin: 0; padding: 0; font-family: 'Poppins', sans-serif; height: 100%;
            overflow-y: scroll;
            overflow-x: hidden; color: var(--text-color); 
            background-color: var(--dark-bg);
            background-image: linear-gradient(rgba(7, 59, 76, 0.8), rgba(7, 59, 76, 0.9)), url('https://images.unsplash.com/photo-1448375240586-882707db888b?q=80&w=2070&auto=format&fit=crop');
            background-attachment: fixed;
            background-size: cover;
        }
        .main-container { display: flex; flex-direction: column; min-height: 100vh; }
        .top-nav { display: flex; align-items: center; padding: 0 30px; background-color: rgba(17, 47, 65, 0.8); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); position: fixed; top: 0; left: 0; right: 0; z-index: 1000; box-shadow: 0 2px 10px var(--shadow-color); }
        .logo-container { display: flex; align-items: center; gap: 15px; }
        .logo-container .svg-logo { width: 50px; height: auto; }
        .logo-container h1 { font-size: 1.5em; margin: 0; color: var(--nav-text-color); }
        .nav-tabs { margin: 0 auto; overflow-x: auto; white-space: nowrap;}
        .nav-tabs .nav-link { background: none; border: none; color: var(--nav-text-color); padding: 20px 25px; font-size: 1em; cursor: pointer; text-decoration: none; position: relative; transition: color 0.3s, opacity 0.3s; opacity: 0.7; display: inline-block; }
        .nav-tabs .nav-link::after { content: ''; position: absolute; bottom: 0; left: 50%; width: 0; height: 3px; background-color: var(--primary-color); transition: all 0.3s ease-in-out; }
        .nav-tabs .nav-link.active, .nav-tabs .nav-link:hover { color: white; opacity: 1; }
        .nav-tabs .nav-link.active::after { width: 100%; left: 0; }
        .top-nav-actions { display: flex; align-items: center; gap: 20px; }
        .action-btn { background: none; border: none; color: var(--nav-text-color); font-size: 1.5em; cursor: pointer; transition: color 0.3s; opacity: 0.8; }
        .action-btn:hover { color: var(--primary-color); opacity: 1; }
        .content-area { padding: 30px; padding-top: 100px; }
        .content-section { min-height: 90vh; padding: 50px 0; border-bottom: 1px solid var(--border-color); display: flex; flex-direction: column; justify-content: center; }
        .content-section:last-child { border-bottom: none; }
        .section-title { font-size: 2.5em; color: var(--primary-color); text-align: center; margin-bottom: 40px; }
        .overview-layout { display: flex; align-items: center; gap: 50px; width: 100%; max-width: 1200px; margin: 0 auto; }
        .overview-info { flex: 1.2; }
        .overview-info .section-title { text-align: left; font-size: 3em; color:white; }
        .overview-info p.subtitle { font-size: 1.2em; opacity: 0.8; margin-top: -30px; margin-bottom: 30px; }
        .overview-image { flex: 1; text-align: center; }
        .overview-image .mobile-ui-svg { max-width: 350px; height: auto; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1)); }
        .overview-info .card { background-color: var(--card-bg); backdrop-filter: blur(5px); }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; }
        .card { background-color: var(--card-bg); padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px var(--shadow-color); backdrop-filter: blur(10px); border: 1px solid var(--border-color); }
        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; font-size: 1.2em; font-weight: 600; }
        .card-header .title { display: flex; align-items: center; }
        .card-header .title i { margin-right: 15px; width: 25px; text-align: center; color: var(--primary-color); }
        .efficiency-light { width: 18px; height: 18px; border-radius: 50%; background-color: #555; transition: background-color 0.5s, box-shadow 0.5s; border: 1px solid rgba(255,255,255,0.2); }
        .efficiency-light.red { background-color: var(--critical-color); box-shadow: 0 0 10px var(--critical-color); }
        .efficiency-light.yellow { background-color: var(--warning-color); box-shadow: 0 0 10px var(--warning-color); }
        .efficiency-light.blue { background-color: var(--info-color-blue); box-shadow: 0 0 10px var(--info-color-blue); }
        .sensor-value { font-size: 2.5em; font-weight: 700; text-align: center; }
        .sensor-value .unit { font-size: 0.5em; font-weight: 400; margin-left: 5px; }
        .chart-container { position: relative; height: 120px; margin-top: 20px; }
        .info-page h3 { color: var(--primary-color); margin-top: 30px; }
        .info-page p { line-height: 1.7; text-align: justify; opacity: 0.9; }
        .info-images { display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap; justify-content: center; align-items: center; }
        .info-images .svg-container { cursor: pointer; text-align:center; width: 100%; max-width: 320px; height: 250px; padding:20px; background-color:rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius:10px; transition: transform 0.3s, box-shadow 0.3s;}
        .info-images .svg-container:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .info-images .svg-container svg { height: 100%; width: auto;}
        .water-volume-card { display: flex; justify-content: space-around; text-align: center;}
        .volume-item p { margin: 0; opacity: 0.8;}
        .volume-item .sensor-value { font-size: 2em; }
        .status-card { display: flex; align-items: center; gap: 20px;}
        .status-card i { font-size: 2.5em; transition: color 0.5s; flex-shrink: 0; }
        .status-card p { margin: 0; font-size: 1.1em; }
        .status-ok { color: var(--primary-color); }
        .status-warn { color: var(--warning-color); }
        .status-crit { color: var(--critical-color); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 2000; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-content { display: flex; gap: 25px; background-color: var(--dark-bg); color: var(--text-color); padding: 40px; border-radius: 15px; width: 90%; max-width: 800px; max-height: 80vh; position: relative; transform: scale(0.9); transition: transform 0.3s; border: 1px solid var(--border-color);}
        .modal-overlay.active .modal-content { transform: scale(1); }
        .modal-close-btn { position: absolute; top: 15px; right: 20px; font-size: 2.5em; color: var(--text-color); cursor: pointer; border: none; background: none; line-height: 1;}
        .modal-svg { flex-basis: 40%; text-align: center; }
        .modal-svg svg { max-width: 100%; height: auto; }
        .modal-text { flex-basis: 60%; overflow-y: auto; padding-right: 15px; }
        .modal-text h2 { color: var(--primary-color); margin-top: 0; }
        .modal-text p { font-size: 0.95em; }
        #back-to-top-btn { position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; background-color: var(--primary-color); color: white; border: none; border-radius: 50%; font-size: 1.5em; cursor: pointer; display: none; justify-content: center; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: opacity 0.3s, transform 0.3s; z-index: 999; }
        #back-to-top-btn.visible { display: flex; opacity: 1; }
        .stats-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .stats-table th, .stats-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color); }
        .stats-table th { background-color: rgba(255,255,255,0.05); }
        .stats-table tr:last-child td { border-bottom: none; }
        .stats-table td:last-child { font-weight: 600; color: var(--primary-color); text-align: right;}
        .weather-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .weather-table th, .weather-table td { padding: 15px; text-align: center; border-bottom: 1px solid var(--border-color); }
        .weather-table th { background-color: rgba(255,255,255,0.05); font-weight: 600;}
        .weather-table td:first-child { text-align: left; font-weight: 500; }
        .weather-table i { font-size: 1.5em; margin-bottom: 5px; display: block;}
        .api-note { font-size: 0.8em; text-align: center; margin-top: 15px; opacity: 0.7; }
        
        @media (max-width: 1024px) { .overview-layout, .modal-content { flex-direction: column; text-align: center; } .overview-info .section-title { text-align: center; } .overview-image { margin-top: 30px; } }
        @media (max-width: 768px) { .top-nav { flex-direction: column; padding: 10px; height: auto; } .nav-tabs { width: 100%; overflow-x: auto; } .content-area { padding-top: 150px; } }
    </style>
</head>
<body>
    <div class="main-container">
        <header class="top-nav">
            <div class="logo-container">
                <img class="svg-logo" src="data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3Cpath id='arrow' d='M50,0 L65,20 L35,20 Z'/%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='20' fill='%233498db'/%3E%3Cuse href='%23arrow' fill='%232ecc71' transform='rotate(0, 50, 50) translate(0, -35)'/%3E%3Cuse href='%23arrow' fill='%232ecc71' transform='rotate(120, 50, 50) translate(0, -35)'/%3E%3Cuse href='%23arrow' fill='%232ecc71' transform='rotate(240, 50, 50) translate(0, -35)'/%3E%3C/svg%3E" alt="logo1111.png">
                <h1>ECOSCYCLE</h1>
            </div>
            <nav class="nav-tabs">
                <a href="#overview" class="nav-link active">Genel Bakış</a>
                <a href="#status" class="nav-link">Sistem Durumu</a>
                <a href="#stats" class="nav-link">İstatistikler</a>
                <a href="#graphs" class="nav-link">Anlık Grafikler</a>
                <a href="#weather" class="nav-link">Canlı Hava Durumu</a>
                <a href="#how-to" class="nav-link">Nasıl Kullanılır?</a>
                <a href="#terminal" class="nav-link">Terminal</a>
            </nav>
            <div class="top-nav-actions">
                <button id="bluetooth-terminal-btn" class="action-btn"><i class="fa-brands fa-bluetooth-b"></i></button>
            </div>
        </header>

        <main class="content-area">
            <section id="overview" class="content-section">
                 <div class="overview-layout">
                    <div class="overview-info">
                        <h2 class="section-title">Akıllı Şehirler İçin Ekolojik Çözümler</h2>
                        <p class="subtitle">ECOSCYCLE, şehirlerimizi iklim değişikliğine karşı daha dirençli hale getirmeyi amaçlayan akıllı bir su ve hava yönetimi sistemidir.</p>
                        <div class="card">
                            <div class="card-header"><div class="title"><i class="fa-solid fa-water"></i><span>Sistem Su Hacmi</span></div></div>
                            <div class="water-volume-card">
                                <div class="volume-item">
                                    <p>Yağmur Bahçesi</p>
                                    <div class="sensor-value" id="rain-garden-volume">2.0 L</div>
                                </div>
                                <div class="volume-item">
                                    <p>Mikroalg Reaktörü</p>
                                    <div class="sensor-value" id="microalgae-volume">1.0 L</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="overview-image">
                        <svg class="mobile-ui-svg" viewBox="0 0 250 500" xmlns="http://www.w3.org/2000/svg"><rect x="5" y="5" width="240" height="490" rx="30" fill="#073B4C" stroke="#2ecc71" stroke-width="2"/><rect x="15" y="15" width="220" height="470" rx="20" fill="#0c2b35"/><defs><linearGradient id="green-grad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#2ecc71"/><stop offset="100%" stop-color="#27ae60"/></linearGradient></defs><path d="M15 45 H 235" stroke="#27ae60" stroke-width="1.5"/><text x="125" y="40" font-family="Poppins" font-size="16" fill="#f1f1f1" text-anchor="middle">ECO-S-ELNSOR</text><rect x="40" y="70" width="170" height="90" rx="10" fill="rgba(0,0,0,0.2)"/><path d="M 60 90 L 60 140 M 80 100 L 80 140 M 100 80 L 100 140 M 120 110 L 120 140 M 140 95 L 140 140 M 160 105 L 160 140 M 180 85 L 180 140" stroke="#2ecc71" stroke-width="2" stroke-linecap="round"/><circle cx="125" cy="220" r="45" fill="rgba(0,0,0,0.2)"/><circle cx="125" cy="340" r="45" fill="rgba(0,0,0,0.2)"/><path fill="#3498db" d="M113,212 l-15,22.5 l30,0 l-15,-22.5 z M125,228 a10,10 0 1,1 0,0.1 z"/><path fill="#fff" d="m118 335 h14 v14 h-14 z m0 20 h14 v6 h-14 z m-10 -13 h8 v8 h-8 z m32 0 h8 v8 h-8 z"/></svg>
                    </div>
                </div>
            </section>
            
            <section id="status" class="content-section">
                <h2 class="section-title">Sistem Durumu ve Verimlilik</h2>
                 <div class="grid-container" style="grid-template-columns: 1fr 1fr;">
                    <div class="card">
                        <div class="card-header"><div class="title"><i class="fas fa-tint"></i><span>Su Verimliliği</span></div></div>
                        <div id="water-status-card" class="status-card">
                            <i id="water-status-icon" class="fas fa-hand-holding-droplet"></i>
                            <p id="water-status-text">Veriler yükleniyor...</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><div class="title"><i class="fas fa-leaf"></i><span>Biyoreaktör Durumu</span></div></div>
                        <div class="status-card">
                            <i id="oxygen-status-icon" class="fas fa-lungs"></i>
                            <p id="oxygen-status-text">Veriler yükleniyor...</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="stats" class="content-section">
                <h2 class="section-title">Verimlilik ve İstatistikler</h2>
                <div class="grid-container" style="grid-template-columns: 1fr 1fr;">
                    <div class="card">
                        <div class="card-header"><div class="title"><i class="fas fa-users"></i><span>Kullanıcı Etkileşimi</span></div></div>
                        <table class="stats-table">
                            <tbody>
                                <tr><td>Günlük Aktif Kullanıcı</td><td id="stats-daily-users">--</td></tr>
                                <tr><td>Ortalama Oturum Süresi</td><td id="stats-session-time">-- dk</td></tr>
                                <tr><td>En Çok Görüntülenen Sekme</td><td id="stats-popular-tab">--</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="card">
                        <div class="card-header"><div class="title"><i class="fas fa-seedling"></i><span>Yağmur Bahçesi Verimliliği</span></div></div>
                        <table class="stats-table">
                             <tbody>
                                <tr><td>Toplam Toplanan Su</td><td id="stats-water-collected">-- L</td></tr>
                                <tr><td>Filtrelenen Su Oranı</td><td id="stats-filter-rate">-- %</td></tr>
                                <tr><td>Azaltılan CO2 Miktarı (Tahmini)</td><td id="stats-co2-reduced">-- kg</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <section id="graphs" class="content-section">
                <h2 class="section-title">Anlık Veri Takibi</h2>
                <div class="grid-container">
                    <div class="card"><div class="card-header"><div class="title"><i class="fas fa-sun"></i><span>Işık Şiddeti</span></div><div id="light-light" class="efficiency-light"></div></div><div class="card-body"><div class="sensor-value" id="light-value">--</div><div class="chart-container"><canvas id="light-chart"></canvas></div></div></div>
                    <div class="card"><div class="card-header"><div class="title"><i class="fas fa-tint"></i><span>Toprak Nemi</span></div></div><div class="card-body"><div class="sensor-value" id="humidity-value">--</div><div class="chart-container"><canvas id="humidity-chart"></canvas></div></div></div>
                    <div class="card"><div class="card-header"><div class="title"><i class="fas fa-thermometer-half"></i><span>Ortam Sıcaklığı</span></div><div id="temp-light" class="efficiency-light"></div></div><div class="card-body"><div class="sensor-value" id="temperature-value">--</div><div class="chart-container"><canvas id="temperature-chart"></canvas></div></div></div>
                    <div class="card"><div class="card-header"><div class="title"><i class="fas fa-wind"></i><span>Hava Kalitesi</span></div><div id="oxygen-light" class="efficiency-light"></div></div><div class="card-body"><div class="sensor-value" id="air-quality-value">--</div><div class="chart-container"><canvas id="air-quality-chart"></canvas></div></div></div>
                </div>
            </section>
            
            <section id="how-to" class="content-section info-page">
                <h2 class="section-title">Nasıl Kullanılır?</h2>
                <div class="info-images">
                     <div class="svg-container info-trigger" data-modal-id="modal-bioreactor">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><defs><linearGradient id="b" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#88f"/><stop offset="100%" stop-color="#66f"/></linearGradient></defs><path fill="#c7ecee" d="M100 130a45 45 0 00-45 45v5h90v-5a45 45 0 00-45-45z"/><path fill="url(#b)" d="M100 130a45 45 0 0145 45v-5a40 40 0 00-80 0v5a45 45 0 0135-45z"/><path fill="#9bceb7" d="M57 140a3 3 0 11-6 0 3 3 0 016 0zm9 13a3 3 0 11-6 0 3 3 0 016 0zm14-5a3 3 0 11-6 0 3 3 0 016 0zm11 11a3 3 0 11-6 0 3 3 0 016 0zm12-7a3 3 0 11-6 0 3 3 0 016 0zm10 9a3 3 0 11-6 0 3 3 0 016 0zm-60-3a4 4 0 11-8 0 4 4 0 018 0zm11 14a4 4 0 11-8 0 4 4 0 018 0zm13-6a4 4 0 11-8 0 4 4 0 018 0zm12 12a4 4 0 11-8 0 4 4 0 018 0zm11-4a4 4 0 11-8 0 4 4 0 018 0zm12 10a4 4 0 11-8 0 4 4 0 018 0z"/><path fill="#fff" d="M60 20 L 140 20 L 140 130 L 60 130 Z" opacity="0.2" rx="10"/><path fill="none" stroke="#66f" stroke-width="4" d="M100 20v110" stroke-linecap="round"/><path fill="#66f" d="M100 20l-15 15h30l-15-15z M100 130l-15-15h30l-15 15z"/><text x="110" y="80" font-family="Poppins" font-size="12" fill="#333">CO2</text><text x="80" y="80" font-family="Poppins" font-size="12" fill="#333" text-anchor="end">O2</text></svg>
                        <p style="margin-top:5px; font-size:0.9em; opacity:0.8;">Biyoreaktör</p>
                    </div>
                    <div class="svg-container info-trigger" data-modal-id="modal-raingarden">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><path fill="#b08968" d="M0 160h200v20H0z"/><path fill="#8c6a4d" d="M0 140h200v20H0z"/><path fill="#e0ac69" d="M0 120h200v20H0z"/><path fill="#2ecc71" d="M50 120 l-10 -20 h20z m40 0 l-10 -30 h20z m60 0 l-10 -25 h20z "/><path fill="#27ae60" d="M30 120 l-10-25 h20z m70 0 l-10 -20 h20z m50 0 l-10-35 h20z"/><path fill="none" stroke="#3498db" stroke-width="3" stroke-dasharray="5 5" d="M40 40v80m120-80v80m-60-90v90"/><path fill="#3498db" d="M40 40l-10 10h20z m120 0l-10 10h20z m-60-10l-10 10h20z"/></svg>
                        <p style="margin-top:5px; font-size:0.9em; opacity:0.8;">Yağmur Bahçesi</p>
                    </div>
                </div>
            </section>
            
            <section id="about" class="content-section info-page">
                <h2 class="section-title">Projenin Amaç ve Hedefleri</h2>
                <ul>
                    <li><b>Şehirlerde Su Yönetimini İyileştirmek:</b> Yağmur suyunu kontrollü bir şekilde toplayarak, arıtarak ve yeniden kullanarak sel riskini azaltmak ve su kaynaklarında verimlilik sağlamak.</li>
                    <li><b>Hava Kirliliğini Azaltmak:</b> Mikroalglerin fotosentetik gücünden faydalanarak havadaki karbon emisyonlarını düşürmek ve kentsel alanlarda oksijen üretimini artırarak daha sağlıklı yaşam alanları oluşturmak.</li>
                    <li><b>Akıllı ve Otomatik Kontrol Sağlamak:</b> IoT sensörleri ile toprak nemi, su akışı ve hava kalitesi gibi kritik verileri anlık olarak takip edip, sistemi en verimli şekilde otomatik olarak yönetmek.</li>
                    <li><b>Yeşil Altyapıyı Güçlendirmek:</b> Kentsel biyoçeşitliliği korumak, şehirlerin ekolojik direncini artırmak ve doğayla uyumlu, sürdürülebilir kalkınma hedeflerine ulaşmayı teşvik etmek.</li>
                </ul>
            </section>

             <section id="weather" class="content-section">
                <h2 class="section-title">Türkiye Canlı Hava Durumu</h2>
                <div class="card">
                    <table class="weather-table" id="weather-table">
                        <thead>
                            <tr>
                                <th>Şehir</th>
                                <th>Durum</th>
                                <th>Sıcaklık</th>
                                <th>Nem</th>
                                <th>Rüzgar</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                     <p class="api-note">Hava durumu verileri OpenWeatherMap tarafından sağlanmaktadır.</p>
                </div>
            </section>
            
            <section id="terminal" class="content-section">
                 <div class="terminal-header"><div class="terminal-title">ECO-S-ELNSOR // MOBIL TERMINAL</div></div>
                <pre id="terminal-output"></pre>
            </section>
        </main>
    </div>

    <div id="modal-bioreactor" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <div class="modal-svg"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><defs><linearGradient id="b" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#88f"/><stop offset="100%" stop-color="#66f"/></linearGradient></defs><path fill="#c7ecee" d="M100 130a45 45 0 00-45 45v5h90v-5a45 45 0 00-45-45z"/><path fill="url(#b)" d="M100 130a45 45 0 0145 45v-5a40 40 0 00-80 0v5a45 45 0 0135-45z"/><path fill="#9bceb7" d="M57 140a3 3 0 11-6 0 3 3 0 016 0zm9 13a3 3 0 11-6 0 3 3 0 016 0zm14-5a3 3 0 11-6 0 3 3 0 016 0zm11 11a3 3 0 11-6 0 3 3 0 016 0zm12-7a3 3 0 11-6 0 3 3 0 016 0zm10 9a3 3 0 11-6 0 3 3 0 016 0zm-60-3a4 4 0 11-8 0 4 4 0 018 0zm11 14a4 4 0 11-8 0 4 4 0 018 0zm13-6a4 4 0 11-8 0 4 4 0 018 0zm12 12a4 4 0 11-8 0 4 4 0 018 0zm11-4a4 4 0 11-8 0 4 4 0 018 0zm12 10a4 4 0 11-8 0 4 4 0 018 0z"/><path fill="#fff" d="M60 20 L 140 20 L 140 130 L 60 130 Z" opacity="0.2" rx="10"/><path fill="none" stroke="#66f" stroke-width="4" d="M100 20v110" stroke-linecap="round"/><path fill="#66f" d="M100 20l-15 15h30l-15-15z M100 130l-15-15h30l-15 15z"/><text x="110" y="80" font-family="Poppins" font-size="12" fill="#333">CO2</text><text x="80" y="80" font-family="Poppins" font-size="12" fill="#333" text-anchor="end">O2</text></svg></div>
            <div class="modal-text"><h2>Biyoreaktör ve Mikroalgler</h2><p>Sistemimizin kalbinde, oksijen üreten mikroalgleri barındıran biyoreaktörler yer alır. Mikroalgler, fotosentez yoluyla havadaki karbondioksiti tüketir ve yerine temiz oksijen salar. Bu, onları kentsel hava kalitesini iyileştirmek için güçlü bir doğal araca dönüştürür. Oksijen verimliliği, anlık veri takibi bölümünden mavi ışık ile gösterilir.</p></div>
        </div>
    </div>
    <div id="modal-raingarden" class="modal-overlay">
         <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <div class="modal-svg"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><path fill="#b08968" d="M0 160h200v20H0z"/><path fill="#8c6a4d" d="M0 140h200v20H0z"/><path fill="#e0ac69" d="M0 120h200v20H0z"/><path fill="#2ecc71" d="M50 120 l-10 -20 h20z m40 0 l-10 -30 h20z m60 0 l-10 -25 h20z "/><path fill="#27ae60" d="M30 120 l-10-25 h20z m70 0 l-10 -20 h20z m50 0 l-10-35 h20z"/><path fill="none" stroke="#3498db" stroke-width="3" stroke-dasharray="5 5" d="M40 40v80m120-80v80m-60-90v90"/><path fill="#3498db" d="M40 40l-10 10h20z m120 0l-10 10h20z m-60-10l-10 10h20z"/></svg></div>
            <div class="modal-text"><h2>Yağmur Bahçesi</h2><p>Yağmur bahçeleri, yağmur suyunu doğal yollarla toplayan, filtreleyen ve yavaşça toprağa sızmasını sağlayan özel tasarlanmış yeşil alanlardır. Geçirimsiz yüzeylerden (çatı, yol vb.) gelen yüzey akışını yöneterek kanalizasyon sistemlerinin yükünü hafifletir, yeraltı sularını besler ve su baskınlarını önler. Toprak nemi, sistem uyarıları bölümünde anlık olarak takip edilir.</p></div>
        </div>
    </div>

    <div id="bluetooth-connecting-overlay">
        <i class="fa-brands fa-bluetooth-b bt-spinner"></i>
        <p>Mobil Terminale Bağlanılıyor...</p>
    </div>

    <a href="#overview" id="back-to-top-btn"><i class="fa-solid fa-arrow-up"></i></a>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const navLinks = document.querySelectorAll('.nav-link');
        const contentSections = document.querySelectorAll('.content-section');
        const btConnectingOverlay = document.getElementById('bluetooth-connecting-overlay');
        const btTerminalBtn = document.getElementById('bluetooth-terminal-btn');
        const backToTopBtn = document.getElementById('back-to-top-btn');
        const mainContentArea = document.querySelector('.main-container');

        // --- SES EFEKTLERİ ---
        const clickSound = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 } }).toDestination();
        const hoverSound = new Tone.MembraneSynth({ pitchDecay: 0.008, octaves: 2, envelope: { attack: 0.0006, decay: 0.2, sustain: 0 } }).toDestination();
        const alertSound = new Tone.Synth({ oscillator: { type: 'triangle' }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.5 } }).toDestination();
        alertSound.volume.value = -6;
        hoverSound.volume.value = -12;
        let canPlayHover = true;
        
        const ambientPlayer = new Tone.Player({
            url: "https://storage.googleapis.com/pedagog-dev-public/ambient-nature.mp3",
            loop: true,
            volume: -20,
            autostart: false
        }).toDestination();
        
        document.body.addEventListener('click', () => {
            Tone.start();
            if (ambientPlayer.state !== 'started') {
                ambientPlayer.start();
            }
        }, { once: true });


        navLinks.forEach(link => { 
            link.addEventListener('mouseenter', () => {
                if (canPlayHover) {
                    hoverSound.triggerAttackRelease("C1", "8n");
                    canPlayHover = false;
                    setTimeout(() => { canPlayHover = true }, 100);
                }
            });
            link.addEventListener('click', e => { 
                e.preventDefault(); 
                clickSound.triggerAttackRelease("C5", "8n");
                document.querySelector(link.getAttribute('href')).scrollIntoView({ behavior: 'smooth' }); 
            }); 
        });
        
        function onScroll() {
            let currentSectionId = '';
            contentSections.forEach(section => { if (mainContentArea.scrollTop >= section.offsetTop - 150) { currentSectionId = section.getAttribute('id'); } });
            navLinks.forEach(link => { link.classList.remove('active'); if (link.getAttribute('href') === `#${currentSectionId}`) { link.classList.add('active'); } });
            if (mainContentArea.scrollTop > 300) { backToTopBtn.style.display = 'flex'; } else { backToTopBtn.style.display = 'none'; }
        }
        mainContentArea.addEventListener('scroll', onScroll);

        btTerminalBtn.addEventListener('click', () => {
            clickSound.triggerAttackRelease("G5", "8n");
            btConnectingOverlay.classList.add('active');
            setTimeout(() => {
                btConnectingOverlay.classList.remove('active');
                document.getElementById('terminal').scrollIntoView({ behavior: 'smooth' });
            }, 2500);
        });
        
        // Modal Logic
        const infoTriggers = document.querySelectorAll('.info-trigger');
        infoTriggers.forEach(trigger => {
            trigger.addEventListener('click', () => {
                const modalId = trigger.getAttribute('data-modal-id');
                document.getElementById(modalId).classList.add('active');
            });
        });

        document.querySelectorAll('.modal-close-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.closest('.modal-overlay').classList.remove('active');
            });
        });
         document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });
        
        function initializeDashboard() {
            const terminalOutput = document.getElementById('terminal-output');
            function writeToTerminal(message) { terminalOutput.innerHTML += message + '\n'; terminalOutput.scrollTop = terminalOutput.scrollHeight; }

            const statsDailyUsers = document.getElementById('stats-daily-users');
            const statsSessionTime = document.getElementById('stats-session-time');
            const statsPopularTab = document.getElementById('stats-popular-tab');
            const statsWaterCollected = document.getElementById('stats-water-collected');
            const statsFilterRate = document.getElementById('stats-filter-rate');
            const statsCo2Reduced = document.getElementById('stats-co2-reduced');
        
            let totalWater = 1500;
            let totalCo2 = 50;
        
            function updateStats() {
                if(!statsDailyUsers) return;
                statsDailyUsers.textContent = Math.floor(Math.random() * 3 + 8); 
                statsSessionTime.textContent = `${(Math.random() * 15 + 5).toFixed(1)} dk`;
                const tabs = ["Genel Bakış", "Anlık Grafikler", "Risk Analizi"];
                statsPopularTab.textContent = tabs[Math.floor(Math.random() * tabs.length)];
                
                totalWater += Math.random() * 1.5; 
                totalCo2 += Math.random() * 0.05;
                
                if(statsWaterCollected) statsWaterCollected.textContent = `${totalWater.toFixed(1)} L`;
                if(statsFilterRate) statsFilterRate.textContent = `${(Math.random() * 2 + 95).toFixed(1)} %`;
                if(statsCo2Reduced) statsCo2Reduced.textContent = `${totalCo2.toFixed(2)} kg`;
            }

            const lightValueEl = document.getElementById('light-value');
            const humidityValueEl = document.getElementById('humidity-value');
            const temperatureValueEl = document.getElementById('temperature-value');
            const airQualityValueEl = document.getElementById('air-quality-value');
            const lightLight = document.getElementById('light-light');
            const tempLight = document.getElementById('temp-light');
            const oxygenLight = document.getElementById('oxygen-light');
            const waterStatusIcon = document.getElementById('water-status-icon');
            const waterStatusText = document.getElementById('water-status-text');
            const oxygenStatusIcon = document.getElementById('oxygen-status-icon');
            const oxygenStatusText = document.getElementById('oxygen-status-text');

            let chartInstances = {};
            function createChart(ctx, color) { return new Chart(ctx, { type: 'line', data: { labels: [], datasets: [{ data: [], borderColor: color, borderWidth: 2.5, fill: true, backgroundColor: 'rgba(44, 62, 80, 0.1)', tension: 0.4, pointRadius: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } } }); }
            if(document.getElementById('light-chart')) chartInstances.light = createChart(document.getElementById('light-chart').getContext('2d'), '#e74c3c');
            if(document.getElementById('humidity-chart')) chartInstances.humidity = createChart(document.getElementById('humidity-chart').getContext('2d'), '#3498db');
            if(document.getElementById('temperature-chart')) chartInstances.temperature = createChart(document.getElementById('temperature-chart').getContext('2d'), '#f39c12');
            if(document.getElementById('air-quality-chart')) chartInstances.airQuality = createChart(document.getElementById('air-quality-chart').getContext('2d'), '#3498db');

            function updateChart(chart, label, newData) { if(!chart) return; chart.data.labels.push(label); chart.data.datasets[0].data.push(newData); if (chart.data.labels.length > 15) { chart.data.labels.shift(); chart.data.datasets[0].data.shift(); } chart.update('none'); }
            
            const OPENWEATHER_API_KEY = "ed7534200e093c9056504df2447ad308";
            const cities = [
                { name: "İstanbul", lat: 41.0082, lon: 28.9784 }, { name: "Ankara", lat: 39.9334, lon: 32.8597 },
                { name: "İzmir", lat: 38.4237, lon: 27.1428 }, { name: "Bursa", lat: 40.1885, lon: 29.0610 },
                { name: "Antalya", lat: 36.8969, lon: 30.7133 },
            ];

            async function fetchWeatherData(city) {
                try {
                    const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${city.lat}&lon=${city.lon}&appid=${OPENWEATHER_API_KEY}&units=metric&lang=tr`);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.error(`Hava durumu verisi alınamadı (${city.name}):`, error);
                    return { name: city.name, error: true };
                }
            }
            
            function getWeatherIconClass(iconCode) {
                const iconMap = { "01d": "fa-sun", "01n": "fa-moon", "02d": "fa-cloud-sun", "02n": "fa-cloud-moon", "03d": "fa-cloud", "03n": "fa-cloud", "04d": "fa-cloud", "04n": "fa-cloud", "09d": "fa-cloud-showers-heavy", "09n": "fa-cloud-showers-heavy", "10d": "fa-cloud-sun-rain", "10n": "fa-cloud-moon-rain", "11d": "fa-bolt", "11n": "fa-bolt", "13d": "fa-snowflake", "13n": "fa-snowflake", "50d": "fa-smog", "50n": "fa-smog" };
                return iconMap[iconCode] || "fa-question-circle";
            }

            function updateWeatherTable() {
                const tableBody = document.querySelector("#weather-table tbody");
                if (!tableBody) return;
                tableBody.innerHTML = '<tr><td colspan="5">Hava durumu verileri yükleniyor...</td></tr>';
                Promise.all(cities.map(fetchWeatherData)).then(results => {
                    tableBody.innerHTML = '';
                    results.forEach(data => {
                        const row = document.createElement('tr');
                        if (data.error || !data.main) {
                            row.innerHTML = `<td colspan="5">${data.name} için veri alınamadı.</td>`;
                        } else {
                            row.innerHTML = `<td>${data.name}</td><td><i class="fas ${getWeatherIconClass(data.weather[0].icon)}"></i> ${data.description}</td><td>${data.main.temp.toFixed(1)}°C</td><td>${data.main.humidity}%</td><td>${data.wind.speed.toFixed(1)} m/s</td>`;
                        }
                        tableBody.appendChild(row);
                    });
                });
            }

            function updateAll(sensorData) {
                if (!sensorData) return;
                const now = new Date();
                const timeLabel = `${now.getHours()}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}`;
                
                lightValueEl.innerHTML = `${sensorData.light}`; updateChart(chartInstances.light, timeLabel, sensorData.light);
                if (sensorData.light <= 300) { if(!lightLight.classList.contains('red')) alertSound.triggerAttackRelease("C4", "8n"); lightLight.className = "efficiency-light red"; } else { lightLight.className = "efficiency-light"; }
                
                humidityValueEl.innerHTML = `${sensorData.soil}`; updateChart(chartInstances.humidity, timeLabel, sensorData.soil);
                
                temperatureValueEl.innerHTML = `${sensorData.temperature.toFixed(1)}<span class="unit">°C</span>`; updateChart(chartInstances.temperature, timeLabel, sensorData.temperature);
                if (sensorData.temperature >= 30) { if(!tempLight.classList.contains('yellow')) alertSound.triggerAttackRelease("E4", "8n"); tempLight.className = "efficiency-light yellow"; } else { tempLight.className = "efficiency-light"; }
                
                airQualityValueEl.innerHTML = `${sensorData.airQuality}<span class="unit">PPM</span>`; updateChart(chartInstances.airQuality, timeLabel, sensorData.airQuality);
                if (sensorData.airQuality < 700) { if(!oxygenLight.classList.contains('blue')) clickSound.triggerAttackRelease("A5", "8n"); oxygenLight.className = "efficiency-light blue"; } else { oxygenLight.className = "efficiency-light"; }

                 if (sensorData.soil > 2000) {
                    waterStatusIcon.className = "fas fa-hand-holding-droplet status-ok";
                    waterStatusText.textContent = "Su verimliliği optimal, toprak nemi ideal seviyede.";
                } else if (sensorData.soil > 1200) {
                     waterStatusIcon.className = "fas fa-hand-holding-droplet status-warn";
                    waterStatusText.textContent = "Toprak nemi azalıyor, sulama gerekebilir.";
                } else {
                    waterStatusIcon.className = "fas fa-hand-holding-droplet status-crit";
                    waterStatusText.textContent = "Kritik nem seviyesi! Acil sulama gerekli.";
                }

                if (sensorData.airQuality > 1500) {
                    oxygenStatusIcon.className = "fas fa-lungs status-crit";
                    oxygenStatusText.textContent = "Düşük oksijen verimliliği.";
                } else if (sensorData.airQuality > 700) {
                    oxygenStatusIcon.className = "fas fa-lungs status-warn";
                    oxygenStatusText.textContent = "Oksijen üretimi orta seviyede.";
                } else {
                     oxygenStatusIcon.className = "fas fa-lungs status-ok";
                    oxygenStatusText.textContent = "Oksijen üretimi yüksek.";
                }

                writeToTerminal(`<span style="color:#888">[${timeLabel}]</span> [DURUM] ${waterStatusText.textContent}, ${oxygenStatusText.textContent}`);
            }
            
            setInterval(() => {
                const simulatedData = { light: Math.floor(Math.random() * 1024), soil: Math.floor(Math.random() * 4096), temperature: (Math.random() * 20 + 15), airQuality: Math.floor(Math.random() * 2000) };
                updateAll(simulatedData);
                updateStats();
            }, 3000);
            updateWeatherTable();
            setInterval(updateWeatherTable, 5 * 60 * 1000);
        }
        
        initializeDashboard();
    });
    </script>
</body>
</html>
